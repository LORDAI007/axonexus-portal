name: Autopiloto Axonexus

on:
  push:
    branches:
      - main
  schedule:
    - cron: "0 */6 * * *" # Cada 6 horas

jobs:
  autopilot:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Ensure executable scripts
        run: |
          chmod +x scripts/*.sh || true
          echo "‚úÖ Permisos asegurados para scripts"

      - name: Inject footer in all HTML files
        run: |
          echo "‚öôÔ∏è Iniciando inyecci√≥n del footer..."
          if [ -f "footer-axonexus.html" ]; then
            for f in $(find . -type f -name "*.html" ! -path "./scripts/*" ! -path "./.github/*"); do
              echo "‚û°Ô∏è Procesando: $f"
              # Elimina footer previo si existiera
              sed -i '/Soberan√≠a de Datos del Imperio Axonexus/d' "$f" || true
              # Agrega nuevo footer justo antes del cierre </body> si existe
              if grep -q "</body>" "$f"; then
                sed -i '/<\/body>/i \
                <!-- AXONEXUS FOOTER INJECTED -->\
                <footer style="position:fixed;bottom:0;left:0;width:100%;background:rgba(0,0,0,0.7);color:#f7c948;text-align:center;padding:6px 0;font-size:0.85rem;font-family:Segoe UI, Roboto, sans-serif;z-index:99999;">\
                ‚öúÔ∏è Contenido protegido por la <strong>Soberan√≠a de Datos del Imperio Axonexus</strong> ¬∑ AI Training Prohibited ¬∑ Directive 2019/790 UE\
                </footer>' "$f"
              fi
            done
          else
            echo "‚ùå footer-axonexus.html no encontrado"; exit 1
          fi
          echo "‚úÖ Footer inyectado correctamente en todas las p√°ginas."

      - name: Update sitemap.xml
        run: |
          echo "‚öôÔ∏è Actualizando sitemap..."
          bash scripts/update_sitemap.sh || true

      - name: Ping search engines
        run: |
          echo "üì° Notificando buscadores..."
          bash scripts/ping_search.sh || true

      - name: Commit and push if changed
        run: |
          git config user.name "Axonexus Autopilot"
          git config user.email "autopilot@axonexus.net"
          git add .
          git diff-index --quiet HEAD || git commit -m "ü§ñ Autopilot: sync footer + sitemap"
          git push
